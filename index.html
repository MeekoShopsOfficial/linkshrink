<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkShrink - Advanced URL Shortener</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #00d4aa;
            --danger: #ff6b6b;
            --warning: #feca57;
            --dark: #2d3436;
            --light: #f8f9fa;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .shape {
            position: absolute;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            right: 10%;
            animation-delay: 5s;
        }

        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 80%;
            left: 70%;
            animation-delay: 10s;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-30px) rotate(120deg); }
            66% { transform: translateY(30px) rotate(240deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .nav-btn.secondary {
            background: transparent;
            color: var(--dark);
            border: 2px solid var(--primary);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        .user-menu {
            position: relative;
            display: none;
        }

        .user-menu.show {
            display: block;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            display: none;
            z-index: 1001;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid #eee;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 50px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
            max-width: 800px;
            width: 100%;
            margin: 120px auto 50px;
            position: relative;
            z-index: 2;
            animation: slideUpFade 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .auth-container {
            max-width: 400px;
            margin: 120px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-title {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .auth-link {
            text-align: center;
            margin-top: 20px;
        }

        .auth-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .dashboard {
            display: none;
        }

        .dashboard.show {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .welcome-text h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .welcome-text p {
            color: #666;
        }

        .rate-limit-info {
            background: linear-gradient(135deg, rgba(254, 202, 87, 0.1), rgba(255, 193, 7, 0.1));
            border: 2px solid rgba(254, 202, 87, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            text-align: center;
            min-width: 200px;
        }

        .rate-limit-text {
            font-size: 0.9rem;
            color: #856404;
            margin-bottom: 5px;
        }

        .rate-limit-count {
            font-size: 1.5rem;
            font-weight: 800;
            color: #856404;
        }

        .shortening-section {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
        }

        .url-input-container {
            position: relative;
            margin-bottom: 20px;
        }

        .url-input {
            width: 100%;
            padding: 18px 24px;
            font-size: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .bulk-input {
            min-height: 120px;
            resize: vertical;
        }

        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            background: transparent;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .links-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-input {
            padding: 10px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            min-width: 250px;
        }

        .links-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .links-table th,
        .links-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .links-table th {
            font-weight: 600;
            color: var(--dark);
            background: #f8f9fa;
        }

        .short-link {
            color: var(--primary);
            font-weight: 600;
            font-family: monospace;
        }

        .original-link {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .link-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .action-btn.edit { background: #feca57; color: white; }
        .action-btn.delete { background: #ff6b6b; color: white; }
        .action-btn.qr { background: #00d4aa; color: white; }
        .action-btn.copy { background: #667eea; color: white; }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.7);
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            z-index: 2001;
            box-shadow: 0 50px 100px rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border: none;
            background: #f8f9fa;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #e9ecef;
            transform: rotate(90deg);
        }

        .error-message {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .qr-container {
            text-align: center;
            padding: 20px;
        }

        .qr-code {
            margin: 20px 0;
        }

        .qr-download-btn {
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .qr-download-btn:hover {
            background: #00b894;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .main-container, .auth-container {
                padding: 25px 20px;
                margin: 100px 20px 50px;
            }
            
            .nav-container {
                padding: 0 15px;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
            
            .links-table {
                font-size: 14px;
            }
            
            .search-input {
                min-width: 100%;
            }
            
            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .auth-forms, .home-content, .dashboard {
            display: none;
        }

        .home-content.show, .auth-forms.show, .dashboard.show {
            display: block;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">LinkShrink</div>
            <div class="nav-buttons" id="navButtons">
                <button class="nav-btn primary" onclick="app.showLogin()">Login</button>
                <button class="nav-btn secondary" onclick="app.showRegister()">Sign Up</button>
            </div>
            <div class="user-menu" id="userMenu">
                <div class="user-avatar" onclick="app.toggleUserMenu()" id="userAvatar"></div>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="dropdown-item" onclick="app.showDashboard()">Dashboard</div>
                    <div class="dropdown-item" onclick="app.logout()">Logout</div>
                </div>
            </div>
        </div>
    </nav>

    <div class="home-content show" id="homeContent">
        <div class="main-container">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 3.5rem; font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 15px;">LinkShrink</h1>
                <p style="font-size: 1.2rem; color: #666; margin-bottom: 10px;">Shrink URLs instantly with advanced features</p>
                <p style="color: #999; font-size: 0.95rem;">Sign up for bulk operations, QR codes, and link management</p>
            </div>
            
            <div style="background: #f8f9fa; border-radius: 16px; padding: 30px; margin-bottom: 40px;">
                <h3 style="margin-bottom: 20px; color: var(--dark);">Try it out (Guest Mode)</h3>
                <div style="margin-bottom: 20px;">
                    <input type="url" id="guestUrlInput" class="url-input" placeholder="Paste your URL here...">
                </div>
                <button onclick="app.guestShrink()" class="btn btn-primary">⚡ Shrink URL</button>
                <div id="guestResult" style="margin-top: 20px; display: none;">
                    <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid var(--primary);">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #666; font-size: 0.9rem;">SHRUNK URL</div>
                        <div style="font-family: monospace; color: var(--primary); font-weight: 600; font-size: 1.1rem; margin-bottom: 15px;" id="guestShortUrl"></div>
                        <button onclick="app.copyGuestUrl()" class="btn btn-secondary">📋 Copy</button>
                    </div>
                    <p style="text-align: center; margin-top: 20px; color: #666;">Sign up to unlock bulk operations, QR codes, and link management!</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px;">
                <div style="background: rgba(102, 126, 234, 0.05); border: 2px solid rgba(102, 126, 234, 0.1); border-radius: 20px; padding: 30px; text-align: center;">
                    <span style="font-size: 3rem; display: block; margin-bottom: 20px;">🚀</span>
                    <h3 style="color: var(--dark); margin-bottom: 10px;">Bulk Operations</h3>
                    <p style="color: #666;">Shrink multiple URLs at once</p>
                </div>
                <div style="background: rgba(102, 126, 234, 0.05); border: 2px solid rgba(102, 126, 234, 0.1); border-radius: 20px; padding: 30px; text-align: center;">
                    <span style="font-size: 3rem; display: block; margin-bottom: 20px;">📱</span>
                    <h3 style="color: var(--dark); margin-bottom: 10px;">QR Codes</h3>
                    <p style="color: #666;">Generate and download QR codes</p>
                </div>
                <div style="background: rgba(102, 126, 234, 0.05); border: 2px solid rgba(102, 126, 234, 0.1); border-radius: 20px; padding: 30px; text-align: center;">
                    <span style="font-size: 3rem; display: block; margin-bottom: 20px;">📊</span>
                    <h3 style="color: var(--dark); margin-bottom: 10px;">Analytics</h3>
                    <p style="color: #666;">Track clicks and manage links</p>
                </div>
            </div>
        </div>
    </div>

    <div class="auth-forms" id="authForms">
        <div class="auth-container" id="loginForm">
            <div class="auth-header">
                <h2 class="auth-title">Welcome Back</h2>
                <p style="color: #666;">Sign in to access your dashboard</p>
            </div>
            <form onsubmit="app.handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required>
                </div>
                <button type="submit" class="auth-btn">Sign In</button>
                <div id="loginError" class="error-message"></div>
            </form>
            <div class="auth-link">
                <p>Don't have an account? <a href="#" onclick="app.showRegister()">Sign up</a></p>
                <p><a href="#" onclick="app.showForgotPassword()">Forgot password?</a></p>
                <p><a href="#" onclick="app.showHome()">← Back to home</a></p>
            </div>
        </div>

        <div class="auth-container" id="registerForm" style="display: none;">
            <div class="auth-header">
                <h2 class="auth-title">Create Account</h2>
                <p style="color: #666;">Join LinkShrink today</p>
            </div>
            <form onsubmit="app.handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="registerName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="confirmPassword" required>
                </div>
                <button type="submit" class="auth-btn">Create Account</button>
                <div id="registerError" class="error-message"></div>
            </form>
            <div class="auth-link">
                <p>Already have an account? <a href="#" onclick="app.showLogin()">Sign in</a></p>
                <p><a href="#" onclick="app.showHome()">← Back to home</a></p>
            </div>
        </div>

        <div class="auth-container" id="forgotPasswordForm" style="display: none;">
            <div class="auth-header">
                <h2 class="auth-title">Reset Password</h2>
                <p style="color: #666;">Enter your email to receive reset instructions</p>
            </div>
            <form onsubmit="app.handleForgotPassword(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="forgotEmail" required>
                </div>
                <button type="submit" class="auth-btn">Send Reset Email</button>
                <div id="forgotError" class="error-message"></div>
                <div id="forgotSuccess" class="success-message"></div>
            </form>
            <div class="auth-link">
                <p><a href="#" onclick="app.showLogin()">← Back to login</a></p>
            </div>
        </div>
    </div>

    <div class="dashboard" id="dashboard">
        <div class="main-container">
            <div class="dashboard-header">
                <div class="welcome-text">
                    <h2>Welcome back, <span id="userName"></span>!</h2>
                    <p>Manage your shortened links and create new ones</p>
                </div>
                <div class="rate-limit-info">
                    <div class="rate-limit-text">Links remaining this hour</div>
                    <div class="rate-limit-count" id="rateLimitCount">20</div>
                </div>
            </div>

            <div class="shortening-section">
                <h3 class="section-title">Create Short Links</h3>
                
                <div class="input-tabs">
                    <button class="tab-btn active" onclick="app.switchTab('single')" id="singleTab">Single URL</button>
                    <button class="tab-btn" onclick="app.switchTab('bulk')" id="bulkTab">Bulk URLs</button>
                </div>

                <div id="singleUrlSection">
                    <div class="url-input-container">
                        <input type="url" class="url-input" id="singleUrl" placeholder="Paste your URL here...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Custom Alias (optional)</label>
                        <input type="text" class="form-input" id="customAlias" placeholder="my-custom-link">
                    </div>
                </div>

                <div id="bulkUrlSection" style="display: none;">
                    <div class="url-input-container">
                        <textarea class="url-input bulk-input" id="bulkUrls" placeholder="Enter multiple URLs, one per line:
https://example.com/page1
https://example.com/page2
https://example.com/page3"></textarea>
                    </div>
                </div>

                <div class="action-buttons">
                    <button onclick="app.shortenUrls()" class="btn btn-primary">
                        ⚡ <span id="shortenBtnText">Shrink URL</span>
                    </button>
                    <button onclick="app.clearInputs()" class="btn btn-secondary">
                        🗑️ Clear
                    </button>
                </div>

                <div id="shortenError" class="error-message"></div>
                <div id="shortenSuccess" class="success-message"></div>
            </div>

            <div class="links-section">
                <div class="table-controls">
                    <h3 class="section-title" style="margin: 0;">Your Links</h3>
                    <input type="text" class="search-input" id="searchLinks" placeholder="🔍 Search links...">
                </div>

                <table class="links-table" id="linksTable">
                    <thead>
                        <tr>
                            <th>Short Link</th>
                            <th>Original URL</th>
                            <th>Clicks</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="linksTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #999;">
                                No links created yet. Create your first link above! 🚀
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <button class="close-btn" onclick="app.hideModal('successModal')">×</button>
            <div class="modal-header">
                <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, var(--success), #00b894); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white;">✨</div>
                <h2 class="modal-title">Link Shrunk Successfully!</h2>
            </div>
            <div id="successModalContent"></div>
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button onclick="app.hideModal('successModal')" class="btn btn-primary" style="flex: 1;">Create Another</button>
                <button onclick="app.copyModalUrl()" class="btn btn-secondary" style="flex: 1;" id="copyModalBtn">Copy Link</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="qrModal">
        <div class="modal">
            <button class="close-btn" onclick="app.hideModal('qrModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title">QR Code</h2>
            </div>
            <div class="qr-container">
                <div class="qr-code" id="qrCodeContainer"></div>
                <div style="margin: 20px 0;">
                    <strong id="qrLinkText"></strong>
                </div>
                <button onclick="app.downloadQR()" class="qr-download-btn">📱 Download PNG</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <button class="close-btn" onclick="app.hideModal('editModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title">Edit Link</h2>
            </div>
            <form onsubmit="app.saveEditedLink(event)">
                <div class="form-group">
                    <label class="form-label">Custom Alias</label>
                    <input type="text" class="form-input" id="editAlias" placeholder="custom-alias">
                </div>
                <div class="form-group">
                    <label class="form-label">Original URL</label>
                    <input type="url" class="form-input" id="editOriginalUrl" required>
                </div>
                <div style="display: flex; gap: 15px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Changes</button>
                    <button type="button" onclick="app.hideModal('editModal')" class="btn btn-secondary" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class LinkShrinkApp {
            constructor() {
                this.currentUser = null;
                this.users = JSON.parse(this.getStorageItem('linkshrink_users') || '{}');
                this.urlDatabase = JSON.parse(this.getStorageItem('linkshrink_urls') || '{}');
                this.rateLimits = JSON.parse(this.getStorageItem('linkshrink_limits') || '{}');
                this.currentTab = 'single';
                this.currentQRUrl = '';
                this.currentModalUrl = '';
                this.currentEditId = '';
                
                this.initializeApp();
                this.handleRedirect();
            }

            getStorageItem(key) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.warn('localStorage not available, using memory storage');
                    if (!this.memoryStorage) this.memoryStorage = {};
                    return this.memoryStorage[key];
                }
            }

            setStorageItem(key, value) {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    console.warn('localStorage not available, using memory storage');
                    if (!this.memoryStorage) this.memoryStorage = {};
                    this.memoryStorage[key] = value;
                }
            }

            initializeApp() {
                const savedUser = this.getStorageItem('linkshrink_current_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.showUserInterface();
                }

                document.getElementById('searchLinks').addEventListener('input', (e) => {
                    this.filterLinks(e.target.value);
                });

                this.cleanupRateLimits();
                
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.user-menu')) {
                        document.getElementById('dropdownMenu').classList.remove('show');
                    }
                });
            }

            handleRedirect() {
                const hash = window.location.hash;
                if (hash && hash.startsWith('#/')) {
                    const shortCode = hash.substring(2);
                    if (this.urlDatabase[shortCode]) {
                        this.urlDatabase[shortCode].clicks++;
                        this.setStorageItem('linkshrink_urls', JSON.stringify(this.urlDatabase));
                        window.location.href = this.urlDatabase[shortCode].original;
                        return;
                    }
                }
            }

            guestShrink() {
                const url = document.getElementById('guestUrlInput').value.trim();
                const resultDiv = document.getElementById('guestResult');
                const shortUrlDiv = document.getElementById('guestShortUrl');

                if (!url) {
                    alert('Please enter a URL');
                    return;
                }

                if (!this.isValidUrl(url)) {
                    alert('Please enter a valid URL with http:// or https://');
                    return;
                }

                const shortCode = this.generateShortCode();
                const linkData = {
                    id: Date.now() + Math.random(),
                    original: url,
                    shortCode: shortCode,
                    created: Date.now(),
                    clicks: 0,
                    owner: 'guest'
                };

                this.urlDatabase[shortCode] = linkData;
                this.setStorageItem('linkshrink_urls', JSON.stringify(this.urlDatabase));

                const shortUrl = `${window.location.origin}${window.location.pathname}#/${shortCode}`;
                shortUrlDiv.textContent = shortUrl;
                this.guestShortUrl = shortUrl;
                resultDiv.style.display = 'block';
            }

            copyGuestUrl() {
                this.copyToClipboard(this.guestShortUrl);
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }

            handleLogin(event) {
                event.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                if (!this.users[email]) {
                    this.showError('loginError', 'Account not found. Please check your email or sign up.');
                    return;
                }

                if (this.users[email].password !== password) {
                    this.showError('loginError', 'Incorrect password. Please try again.');
                    return;
                }

                this.currentUser = this.users[email];
                this.setStorageItem('linkshrink_current_user', JSON.stringify(this.currentUser));
                this.showUserInterface();
                this.hideError('loginError');
            }

            handleRegister(event) {
                event.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (password !== confirmPassword) {
                    this.showError('registerError', 'Passwords do not match.');
                    return;
                }

                if (this.users[email]) {
                    this.showError('registerError', 'An account with this email already exists.');
                    return;
                }

                const newUser = {
                    name: name,
                    email: email,
                    password: password,
                    joined: Date.now()
                };

                this.users[email] = newUser;
                this.setStorageItem('linkshrink_users', JSON.stringify(this.users));

                this.currentUser = newUser;
                this.setStorageItem('linkshrink_current_user', JSON.stringify(this.currentUser));
                this.showUserInterface();
                this.hideError('registerError');
            }

            handleForgotPassword(event) {
                event.preventDefault();
                const email = document.getElementById('forgotEmail').value;

                if (!this.users[email]) {
                    this.showError('forgotError', 'No account found with this email address.');
                    return;
                }

                this.showSuccess('forgotSuccess', 'Password reset instructions have been sent to your email.');
                setTimeout(() => {
                    this.showLogin();
                }, 3000);
            }

            logout() {
                this.currentUser = null;
                try {
                    localStorage.removeItem('linkshrink_current_user');
                } catch (e) {
                    if (this.memoryStorage) delete this.memoryStorage['linkshrink_current_user'];
                }
                this.showHome();
                this.toggleUserMenu();
            }

            showHome() {
                this.hideAllSections();
                document.getElementById('homeContent').classList.add('show');
                document.getElementById('navButtons').style.display = 'flex';
                document.getElementById('userMenu').classList.remove('show');
            }

            showLogin() {
                this.hideAllSections();
                document.getElementById('authForms').classList.add('show');
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('forgotPasswordForm').style.display = 'none';
            }

            showRegister() {
                this.hideAllSections();
                document.getElementById('authForms').classList.add('show');
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
                document.getElementById('forgotPasswordForm').style.display = 'none';
            }

            showForgotPassword() {
                this.hideAllSections();
                document.getElementById('authForms').classList.add('show');
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('forgotPasswordForm').style.display = 'block';
            }

            showDashboard() {
                this.hideAllSections();
                document.getElementById('dashboard').classList.add('show');
                document.getElementById('userName').textContent = this.currentUser.name;
                this.updateRateLimit();
                this.loadUserLinks();
                this.toggleUserMenu();
            }

            showUserInterface() {
                document.getElementById('navButtons').style.display = 'none';
                document.getElementById('userMenu').classList.add('show');
                document.getElementById('userAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                this.showDashboard();
            }

            hideAllSections() {
                document.getElementById('homeContent').classList.remove('show');
                document.getElementById('authForms').classList.remove('show');
                document.getElementById('dashboard').classList.remove('show');
            }

            toggleUserMenu() {
                const dropdown = document.getElementById('dropdownMenu');
                dropdown.classList.toggle('show');
            }

            switchTab(tab) {
                this.currentTab = tab;
                
                document.getElementById('singleTab').classList.toggle('active', tab === 'single');
                document.getElementById('bulkTab').classList.toggle('active', tab === 'bulk');
                
                document.getElementById('singleUrlSection').style.display = tab === 'single' ? 'block' : 'none';
                document.getElementById('bulkUrlSection').style.display = tab === 'bulk' ? 'block' : 'none';
                
                document.getElementById('shortenBtnText').textContent = tab === 'single' ? 'Shrink URL' : 'Shrink All URLs';
            }

            checkRateLimit() {
                if (!this.currentUser) return false;
                
                const now = Date.now();
                const hourKey = Math.floor(now / (1000 * 60 * 60));
                const userKey = this.currentUser.email;
                
                if (!this.rateLimits[userKey]) {
                    this.rateLimits[userKey] = {};
                }

                if (!this.rateLimits[userKey][hourKey]) {
                    this.rateLimits[userKey][hourKey] = 0;
                }

                return this.rateLimits[userKey][hourKey] < 20;
            }

            incrementRateLimit() {
                if (!this.currentUser) return;
                
                const now = Date.now();
                const hourKey = Math.floor(now / (1000 * 60 * 60));
                const userKey = this.currentUser.email;
                
                if (!this.rateLimits[userKey]) {
                    this.rateLimits[userKey] = {};
                }

                if (!this.rateLimits[userKey][hourKey]) {
                    this.rateLimits[userKey][hourKey] = 0;
                }

                this.rateLimits[userKey][hourKey]++;
                this.setStorageItem('linkshrink_limits', JSON.stringify(this.rateLimits));
                this.updateRateLimit();
            }

            updateRateLimit() {
                if (!this.currentUser) return;
                
                const now = Date.now();
                const hourKey = Math.floor(now / (1000 * 60 * 60));
                const userKey = this.currentUser.email;
                
                const used = this.rateLimits[userKey] && this.rateLimits[userKey][hourKey] ? this.rateLimits[userKey][hourKey] : 0;
                const remaining = Math.max(0, 20 - used);
                
                document.getElementById('rateLimitCount').textContent = remaining;
                
                const rateLimitElement = document.getElementById('rateLimitCount');
                if (remaining <= 5) {
                    rateLimitElement.style.color = '#dc3545';
                } else if (remaining <= 10) {
                    rateLimitElement.style.color = '#ffc107';
                } else {
                    rateLimitElement.style.color = '#856404';
                }
            }

            cleanupRateLimits() {
                const now = Date.now();
                const currentHour = Math.floor(now / (1000 * 60 * 60));
                
                for (const userKey in this.rateLimits) {
                    for (const hourKey in this.rateLimits[userKey]) {
                        if (parseInt(hourKey) < currentHour - 24) {
                            delete this.rateLimits[userKey][hourKey];
                        }
                    }
                }
                
                this.setStorageItem('linkshrink_limits', JSON.stringify(this.rateLimits));
            }

            shortenUrls() {
                if (!this.currentUser) {
                    this.showError('shortenError', 'Please log in to create links.');
                    return;
                }

                const urls = this.currentTab === 'single' 
                    ? [document.getElementById('singleUrl').value.trim()]
                    : document.getElementById('bulkUrls').value.split('\n').filter(url => url.trim());

                if (urls.length === 0 || (urls.length === 1 && urls[0] === '')) {
                    this.showError('shortenError', 'Please enter at least one URL.');
                    return;
                }

                if (urls.length > 1) {
                    const now = Date.now();
                    const hourKey = Math.floor(now / (1000 * 60 * 60));
                    const userKey = this.currentUser.email;
                    const used = this.rateLimits[userKey] && this.rateLimits[userKey][hourKey] ? this.rateLimits[userKey][hourKey] : 0;
                    const remaining = Math.max(0, 20 - used);
                    
                    if (urls.length > remaining) {
                        this.showError('shortenError', `You can only create ${remaining} more links this hour. Try again later or reduce the number of URLs.`);
                        return;
                    }
                } else {
                    if (!this.checkRateLimit()) {
                        this.showError('shortenError', 'You have reached your hourly limit of 20 links. Please try again later.');
                        return;
                    }
                }

                const validUrls = [];
                for (const url of urls) {
                    if (!this.isValidUrl(url)) {
                        this.showError('shortenError', `Invalid URL: ${url}. Please include http:// or https://`);
                        return;
                    }
                    validUrls.push(url);
                }

                const customAlias = this.currentTab === 'single' ? document.getElementById('customAlias').value.trim() : '';

                if (customAlias && this.urlDatabase[customAlias]) {
                    this.showError('shortenError', 'This custom alias is already taken. Please choose another one.');
                    return;
                }

                const results = [];
                for (const url of validUrls) {
                    const shortCode = customAlias || this.generateShortCode();
                    const linkData = {
                        id: Date.now() + Math.random(),
                        original: url,
                        shortCode: shortCode,
                        created: Date.now(),
                        clicks: 0,
                        owner: this.currentUser.email
                    };

                    this.urlDatabase[shortCode] = linkData;
                    this.incrementRateLimit();
                    
                    const shortUrl = `${window.location.origin}${window.location.pathname}#/${shortCode}`;
                    results.push({
                        original: url,
                        short: shortUrl
                    });
                }

                this.setStorageItem('linkshrink_urls', JSON.stringify(this.urlDatabase));

                this.showSuccessModal(results);
                this.clearInputs();
                this.loadUserLinks();
                this.hideError('shortenError');
            }

            generateShortCode() {
                const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = '';
                
                do {
                    result = '';
                    for (let i = 0; i < 6; i++) {
                        result += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                } while (this.urlDatabase[result]);
                
                return result;
            }

            isValidUrl(string) {
                try {
                    new URL(string);
                    return string.startsWith('http://') || string.startsWith('https://');
                } catch (_) {
                    return false;
                }
            }

            clearInputs() {
                document.getElementById('singleUrl').value = '';
                document.getElementById('customAlias').value = '';
                document.getElementById('bulkUrls').value = '';
            }

            showSuccessModal(results) {
                let content = '';
                
                if (results.length === 1) {
                    content = `
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="margin-bottom: 15px;">
                                <div style="font-weight: 600; color: #666; font-size: 0.9rem; margin-bottom: 5px;">ORIGINAL URL</div>
                                <div style="word-break: break-all; color: #495057;">${results[0].original}</div>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: #666; font-size: 0.9rem; margin-bottom: 5px;">SHRUNK URL</div>
                                <div style="font-family: monospace; color: var(--primary); font-weight: 600; font-size: 1.1rem;">${results[0].short}</div>
                            </div>
                        </div>
                    `;
                    this.currentModalUrl = results[0].short;
                } else {
                    content = `
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                            <h4 style="margin-bottom: 15px;">Successfully created ${results.length} short links:</h4>
                    `;
                    
                    results.forEach((result, index) => {
                        content += `
                            <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Link ${index + 1}</div>
                                <div style="font-family: monospace; color: var(--primary); font-weight: 600; word-break: break-all;">${result.short}</div>
                            </div>
                        `;
                    });
                    
                    content += `</div>`;
                    this.currentModalUrl = results[0].short;
                }

                document.getElementById('successModalContent').innerHTML = content;
                this.showModal('successModal');
            }

            copyModalUrl() {
                this.copyToClipboard(this.currentModalUrl);
                document.getElementById('copyModalBtn').textContent = '✅ Copied!';
                setTimeout(() => {
                    document.getElementById('copyModalBtn').textContent = 'Copy Link';
                }, 2000);
            }

            showModal(modalId) {
                document.getElementById(modalId).classList.add('show');
                setTimeout(() => {
                    document.getElementById(modalId).querySelector('.modal').classList.add('show');
                }, 10);
            }

            hideModal(modalId) {
                document.getElementById(modalId).querySelector('.modal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById(modalId).classList.remove('show');
                }, 400);
            }

            loadUserLinks() {
                if (!this.currentUser) return;
                
                const tbody = document.getElementById('linksTableBody');
                const userLinks = Object.values(this.urlDatabase).filter(link => link.owner === this.currentUser.email);

                if (userLinks.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #999;">
                                No links created yet. Create your first link above! 🚀
                            </td>
                        </tr>
                    `;
                    return;
                }

                userLinks.sort((a, b) => b.created - a.created);

                tbody.innerHTML = userLinks.map(link => {
                    const shortUrl = `${window.location.origin}${window.location.pathname}#/${link.shortCode}`;
                    return `
                        <tr>
                            <td>
                                <span class="short-link">${shortUrl}</span>
                            </td>
                            <td>
                                <div class="original-link" title="${link.original}">${link.original}</div>
                            </td>
                            <td>${link.clicks}</td>
                            <td>${new Date(link.created).toLocaleDateString()}</td>
                            <td>
                                <div class="link-actions">
                                    <button class="action-btn copy" onclick="app.copyToClipboard('${shortUrl}')" title="Copy">📋</button>
                                    <button class="action-btn qr" onclick="app.showQRCode('${link.shortCode}')" title="QR Code">📱</button>
                                    <button class="action-btn edit" onclick="app.editLink('${link.shortCode}')" title="Edit">✏️</button>
                                    <button class="action-btn delete" onclick="app.deleteLink('${link.shortCode}')" title="Delete">🗑️</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            filterLinks(searchTerm) {
                const tbody = document.getElementById('linksTableBody');
                const rows = tbody.getElementsByTagName('tr');

                for (let row of rows) {
                    if (row.cells.length < 5) continue;
                    
                    const shortLink = row.cells[0]?.textContent || '';
                    const originalUrl = row.cells[1]?.textContent || '';
                    
                    const matches = shortLink.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                   originalUrl.toLowerCase().includes(searchTerm.toLowerCase());
                    
                    row.style.display = matches ? '' : 'none';
                }
            }

            copyToClipboard(text) {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        const btn = event.target;
                        if (btn.textContent === '📋') {
                            btn.textContent = '✅';
                            setTimeout(() => btn.textContent = '📋', 2000);
                        }
                    });
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    const btn = event.target;
                    if (btn.textContent === '📋') {
                        btn.textContent = '✅';
                        setTimeout(() => btn.textContent = '📋', 2000);
                    }
                }
            }

            showQRCode(shortCode) {
                const url = `${window.location.origin}${window.location.pathname}#/${shortCode}`;
                this.currentQRUrl = url;
                
                const qrContainer = document.getElementById('qrCodeContainer');
                qrContainer.innerHTML = '<div>Generating QR Code...</div>';
                
                document.getElementById('qrLinkText').textContent = url;
                this.showModal('qrModal');

                if (typeof QRCode !== 'undefined') {
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: url,
                        width: 256,
                        height: 256,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                } else {
                    qrContainer.innerHTML = this.generateSimpleQR(url);
                }
            }

            generateSimpleQR(text) {
                const size = 256;
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, size, size);
                
                ctx.fillStyle = 'black';
                const blockSize = 8;
                const blocks = size / blockSize;
                const hash = this.simpleHash(text);
                
                for (let y = 0; y < blocks; y++) {
                    for (let x = 0; x < blocks; x++) {
                        const shouldFill = (hash + x * y) % 3 === 0;
                        if (shouldFill) {
                            ctx.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
                        }
                    }
                }
                
                // Add positioning squares
                const cornerSize = blockSize * 3;
                ctx.fillRect(0, 0, cornerSize, cornerSize);
                ctx.fillRect(size - cornerSize, 0, cornerSize, cornerSize);
                ctx.fillRect(0, size - cornerSize, cornerSize, cornerSize);
                
                ctx.fillStyle = 'white';
                ctx.fillRect(blockSize, blockSize, blockSize, blockSize);
                ctx.fillRect(size - cornerSize + blockSize, blockSize, blockSize, blockSize);
                ctx.fillRect(blockSize, size - cornerSize + blockSize, blockSize, blockSize);
                
                return canvas;
            }

            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }

            downloadQR() {
                const qrContainer = document.getElementById('qrCodeContainer');
                let canvas = qrContainer.querySelector('canvas');
                
                if (!canvas) {
                    // If QRCode library created an image, convert it to canvas
                    const img = qrContainer.querySelector('img');
                    if (img) {
                        canvas = document.createElement('canvas');
                        canvas.width = 256;
                        canvas.height = 256;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                    } else {
                        // Generate a simple QR code canvas
                        canvas = this.generateSimpleQR(this.currentQRUrl);
                    }
                }
                
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = `qr-code-${Date.now()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            }

            editLink(shortCode) {
                const link = this.urlDatabase[shortCode];
                if (!link || link.owner !== this.currentUser.email) return;

                this.currentEditId = shortCode;
                document.getElementById('editAlias').value = shortCode;
                document.getElementById('editOriginalUrl').value = link.original;
                this.showModal('editModal');
            }

            saveEditedLink(event) {
                event.preventDefault();
                const newAlias = document.getElementById('editAlias').value.trim();
                const newUrl = document.getElementById('editOriginalUrl').value.trim();
                
                if (!this.isValidUrl(newUrl)) {
                    alert('Please enter a valid URL.');
                    return;
                }

                if (newAlias !== this.currentEditId && this.urlDatabase[newAlias]) {
                    alert('This alias is already taken.');
                    return;
                }

                const linkData = this.urlDatabase[this.currentEditId];
                
                // If alias changed, create new entry and delete old one
                if (newAlias !== this.currentEditId) {
                    delete this.urlDatabase[this.currentEditId];
                    linkData.shortCode = newAlias;
                    this.urlDatabase[newAlias] = linkData;
                }
                
                linkData.original = newUrl;
                
                this.setStorageItem('linkshrink_urls', JSON.stringify(this.urlDatabase));
                this.hideModal('editModal');
                this.loadUserLinks();
            }

            deleteLink(shortCode) {
                if (!this.urlDatabase[shortCode] || this.urlDatabase[shortCode].owner !== this.currentUser.email) return;
                
                if (confirm('Are you sure you want to delete this link? This action cannot be undone.')) {
                    delete this.urlDatabase[shortCode];
                    this.setStorageItem('linkshrink_urls', JSON.stringify(this.urlDatabase));
                    this.loadUserLinks();
                }
            }

            showError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                errorElement.textContent = message;
                errorElement.classList.add('show');
                setTimeout(() => {
                    errorElement.classList.remove('show');
                }, 5000);
            }

            hideError(elementId) {
                const errorElement = document.getElementById(elementId);
                errorElement.classList.remove('show');
            }

            showSuccess(elementId, message) {
                const successElement = document.getElementById(elementId);
                successElement.textContent = message;
                successElement.classList.add('show');
                setTimeout(() => {
                    successElement.classList.remove('show');
                }, 5000);
            }
        }

        // Initialize the application
        const app = new LinkShrinkApp();

        // Handle hash changes for URL redirects
        window.addEventListener('hashchange', () => {
            app.handleRedirect();
        });

        // Handle form submissions
        window.handleLogin = (event) => app.handleLogin(event);
        window.handleRegister = (event) => app.handleRegister(event);
        window.handleForgotPassword = (event) => app.handleForgotPassword(event);
    </script>
</body>
</html>
